<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leave Return Advice Form - إقرار عودة للعمل</title>
    <!-- Google Fonts for Mirza (Arabic) -->
    <link href="https://fonts.googleapis.com/css2?family=Mirza:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Calibri', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Company Header */
        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid #2c5f8c;
            margin-bottom: 25px;
        }
        
        .company-logo-section {
            display: flex;
            align-items: center;
        }
        
        .logo-placeholder {
            width: 70px;
            height: 70px;
            background-color: #f0f5ff;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #666;
            font-size: 12px;
            text-align: center;
        }
        
        .company-name {
            display: flex;
            flex-direction: column;
        }
        
        .company-name-english {
            font-family: 'Calibri', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: #1e4569;
        }
        
        .company-name-arabic {
            font-family: 'Mirza', cursive;
            font-size: 22px;
            color: #1e4569;
            direction: rtl;
        }
        
        .company-slogan {
            font-family: 'Mirza', cursive;
            font-size: 16px;
            color: #2c5f8c;
            direction: rtl;
            text-align: right;
            margin-top: 5px;
        }
        
        /* Form Title */
        .form-title-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .form-title-arabic {
            font-family: 'Mirza', cursive;
            font-size: 28px;
            color: #2c5f8c;
            direction: rtl;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .form-title-english {
            font-family: 'Calibri', sans-serif;
            font-size: 22px;
            color: #2c5f8c;
            font-weight: 600;
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            background-color: #f0f5ff;
            padding: 8px 12px;
            border-right: 4px solid #2c5f8c;
            margin-bottom: 15px;
            font-weight: 600;
            color: #2c5f8c;
            font-size: 16px;
        }
        
        .bilingual-row {
            display: flex;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        
        .english-side, .arabic-side {
            flex: 1;
            padding: 0 10px;
        }
        
        .english-side {
            text-align: left;
            font-family: 'Calibri', sans-serif;
        }
        
        .arabic-side {
            text-align: right;
            direction: rtl;
            font-family: 'Mirza', cursive;
            font-size: 18px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
        }
        
        .input-group input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #2c5f8c;
            box-shadow: 0 0 0 2px rgba(44, 95, 140, 0.2);
        }
        
        .form-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 1px solid #333;
        }
        
        .form-table td {
            padding: 10px;
            border: 1px solid #333;
            vertical-align: top;
        }
        
        .signature-section {
            margin-top: 30px;
        }
        
        .signature-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .signature-box {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
        }
        
        .signature-box h4 {
            margin-bottom: 8px;
            color: #2c5f8c;
            font-size: 16px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .signature-box .arabic-text {
            font-family: 'Mirza', cursive;
            font-size: 18px;
            direction: rtl;
        }
        
        .signature-box .english-text {
            font-family: 'Calibri', sans-serif;
            font-size: 14px;
            margin-top: 3px;
        }
        
        .signature-line {
            height: 1px;
            background-color: #333;
            margin-top: 40px;
            margin-bottom: 5px;
        }
        
        .signature-placeholder {
            margin-top: 5px;
            color: #666;
            font-size: 14px;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .generate-btn {
            background-color: #2c5f8c;
            color: white;
        }
        
        .generate-btn:hover {
            background-color: #1e4569;
        }
        
        .reset-btn {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .reset-btn:hover {
            background-color: #ddd;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #777;
            font-size: 14px;
        }
        
        /* PDF Preview Styling */
        #pdf-preview {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
            display: none;
        }
        
        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2c5f8c;
        }
        
        .pdf-logo-section {
            display: flex;
            align-items: center;
        }
        
        .pdf-logo-placeholder {
            width: 250px;
            height: 100px;
            background-color: #f0f5ff;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            overflow: hidden; /* Add this */
        }

        .pdf-logo-placeholder img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Add this for proper scaling */
        }
        
        .pdf-company-name-english {
            font-family: 'Calibri', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: #1e4569;
        }
        
        .pdf-company-name-arabic {
            font-family: 'Mirza', cursive;
            font-size: 18px;
            color: #1e4569;
            direction: rtl;
        }
        
        .pdf-company-slogan {
            font-family: 'Mirza', cursive;
            font-size: 14px;
            color: #2c5f8c;
            direction: rtl;
            text-align: right;
        }
        
        .pdf-form-title-section {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .pdf-form-title-arabic {
            font-family: 'Mirza', cursive;
            font-size: 24px;
            color: #2c5f8c;
            direction: rtl;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .pdf-form-title-english {
            font-family: 'Calibri', sans-serif;
            font-size: 20px;
            color: #2c5f8c;
            font-weight: 600;
        }
        
        @media print {
            .no-print {
                display: none;
            }
        }
        
        /* Date input styling for RTL */
        input[type="date"] {
            font-family: inherit;
        }
        
        /* Make sure all borders are solid */
        .solid-border {
            border: 1px solid #333 !important;
        }

        .logo-placeholder {
            width: 250px;
            height: 100px;
            background-color: #f0f5ff;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            overflow: hidden; /* Add this */
        }

        .logo-placeholder img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Add this for proper scaling */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Company Header -->
        <div class="company-header">
            <div class="company-logo-section">
                <div class="logo-placeholder">
                <img src="Al Eid Logisitic Logo.jpg" alt="Al-Eid International Logistics Logo">
                </div>

                <div class="company-name">
                    <div class="company-name-english">Al-Eid International Logistics Company</div>
                    <div class="company-name-arabic">شركة العيد انترناشيونال لوجستكس</div>
                </div>
            </div>
            <div class="company-slogan">
                شركة العيد الدولية للوجستيات
            </div>
        </div>
        
        <!-- Form Title -->
        <div class="form-title-section">
            <div class="form-title-arabic">إقـــرار عــــودة للعمـــــل</div>
            <div class="form-title-english">Advice of Return from Leave</div>
        </div>
        
        <!-- Form Input Section -->
        <div class="form-section no-print">
            <div class="section-title">Personal Information / المعلومات الشخصية</div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="employeeName">Employee Name / اسم الموظف</label>
                        <input type="text" id="employeeName" placeholder="Enter employee name">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="employeeNameAr">اسم الموظف</label>
                        <input type="text" id="employeeNameAr" placeholder="أدخل اسم الموظف" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="employeeId">Employee ID / رقم الموظف</label>
                        <input type="text" id="employeeId" placeholder="Enter employee ID">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="employeeIdAr">رقم الموظف</label>
                        <input type="text" id="employeeIdAr" placeholder="أدخل رقم الموظف" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="department">Department / القسم</label>
                        <input type="text" id="department" placeholder="Enter department name">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="departmentAr">القسم</label>
                        <input type="text" id="departmentAr" placeholder="أدخل اسم القسم" style="direction: rtl;">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-section no-print">
            <div class="section-title">Leave Details / تفاصيل الإجازة</div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="leaveStartDate">Leave Start Date / تاريخ بداية الإجازة</label>
                        <input type="date" id="leaveStartDate">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="leaveStartDateAr">تاريخ بداية الإجازة</label>
                        <input type="date" id="leaveStartDateAr" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="leaveEndDate">Leave End Date / تاريخ نهاية الإجازة</label>
                        <input type="date" id="leaveEndDate">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="leaveEndDateAr">تاريخ نهاية الإجازة</label>
                        <input type="date" id="leaveEndDateAr" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="returnDate">Actual Return Date / تاريخ العودة الفعلي</label>
                        <input type="date" id="returnDate">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="returnDateAr">تاريخ العودة الفعلي</label>
                        <input type="date" id="returnDateAr" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="expectedReturnDate">Expected Return Date / تاريخ العودة المتوقع</label>
                        <input type="date" id="expectedReturnDate">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="expectedReturnDateAr">تاريخ العودة المتوقع</label>
                        <input type="date" id="expectedReturnDateAr" style="direction: rtl;">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-section no-print">
            <div class="section-title">Leave Type & Duration / نوع الإجازة والمدة</div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="paidLeaveDays">Number of Paid Leave Days / عدد أيام الإجازة المدفوعة</label>
                        <input type="number" id="paidLeaveDays" min="0" value="0">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="paidLeaveDaysAr">عدد أيام الإجازة المدفوعة</label>
                        <input type="number" id="paidLeaveDaysAr" min="0" value="0" style="direction: rtl;">
                    </div>
                </div>
            </div>
            
            <div class="bilingual-row">
                <div class="english-side">
                    <div class="input-group">
                        <label for="unpaidLeaveDays">Number of Unpaid Leave Days / عدد أيام الإجازة غير المدفوعة</label>
                        <input type="number" id="unpaidLeaveDays" min="0" value="0">
                    </div>
                </div>
                <div class="arabic-side">
                    <div class="input-group">
                        <label for="unpaidLeaveDaysAr">عدد أيام الإجازة غير المدفوعة</label>
                        <input type="number" id="unpaidLeaveDaysAr" min="0" value="0" style="direction: rtl;">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PDF Preview Section -->
        <div id="pdf-preview">
            <!-- PDF Header -->
            <div class="pdf-header">
                <div class="pdf-logo-section">
                    <div class="pdf-logo-placeholder">
                        <img id="pdf-logo-img" src="Al Eid Logisitic Logo.jpg" alt="Al-Eid International Logistics Logo" onerror="this.style.display='none'">
                    </div>
                    <div>
                        <div class="pdf-company-name-english">Al-Eid International Logistics Company</div>
                        <div class="pdf-company-name-arabic">شركة العيد انترناشيونال لوجستكس</div>
                    </div>
                </div>
                <div class="pdf-company-slogan">
                    شركة الجيـد الدولية للوجستيات
                </div>
            </div>
            
            <!-- PDF Form Title -->
            <div class="pdf-form-title-section">
                <div class="pdf-form-title-arabic">إقـــرار عــــودة للعمـــــل</div>
                <div class="pdf-form-title-english">Advice of Return from Leave</div>
            </div>
            
            <!-- PDF Content -->
            <table class="form-table solid-border">
                <tr>
                    <td width="50%" style="font-family: 'Calibri', sans-serif; padding: 15px;">
                        <strong>Date:</strong> <span id="preview-date">DD/MM/YYYY</span><br><br>
                        <strong>To: Accounts Department (Staff Record & Pay Section)</strong><br><br>
                        <strong>I, The Undersigned</strong><br>
                        I Have Returned From My Holidays Which Commenced<br>
                        <span id="preview-start-date">[Start Date]</span>
                    </td>
                    <td width="50%" style="font-family: 'Mirza', cursive; direction: rtl; text-align: right; padding: 15px;">
                        <strong>التاريخ:</strong> <span id="preview-date-ar">DD/MM/YYYY</span><br><br>
                        <strong>إلى قسم الحسابات (شعبة شؤون الموظفين والرواتب)</strong><br><br>
                        <strong>أنا الموقع أدناه:</strong><br>
                        قد عدت من إجازتي التي بدأت بتاريخ<br>
                        <span id="preview-start-date-ar">[Start Date]</span>
                    </td>
                </tr>
                <tr>
                    <td style="font-family: 'Calibri', sans-serif; padding: 15px;">
                        And Expired on <span id="preview-end-date">[End Date]</span><br>
                        And Have Joined Duty From <span id="preview-return-date">[Return Date]</span>
                    </td>
                    <td style="font-family: 'Mirza', cursive; direction: rtl; text-align: right; padding: 15px;">
                        وانتهت بتاريخ <span id="preview-end-date-ar">[End Date]</span><br>
                        وباشرت عملي اعتبارًا من التاريخ <span id="preview-return-date-ar">[Return Date]</span>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="height: 80px; padding: 15px;"></td>
                </tr>
                <tr>
                    <!-- Single Row for Signatures -->
                    <td colspan="2" style="padding: 15px;">
                        <div class="signature-row">
                            <div class="signature-box">
                                <h4>
                                    <span class="arabic-text">اعتماد مدير القسم</span>
                                    <span class="english-text">Head of Department</span>
                                </h4>
                                <div class="signature-line"></div>
                                <div class="signature-placeholder"></div>
                            </div>
                            <div class="signature-box">
                                <h4>
                                    <span class="arabic-text">اعتماد المدير العام</span>
                                    <span class="english-text">General Manager</span>
                                </h4>
                                <div class="signature-line"></div>
                                <div class="signature-placeholder"></div>
                            </div>
                            <div class="signature-box">
                                <h4>
                                    <span class="arabic-text">توقيع الموظف</span>
                                    <span class="english-text">Signature of Employee</span>
                                </h4>
                                <div class="signature-line"></div>
                                <div class="signature-placeholder"></div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td style="font-family: 'Calibri', sans-serif; padding: 15px;">
                        <strong>Particulars of Staff Record</strong><br><br>
                        <strong>Expected Date of Return:</strong> <span id="preview-expected-return">[Expected Date]</span><br>
                        <strong>Actual Date of Return:</strong> <span id="preview-actual-return">[Actual Date]</span><br>
                        <strong>No. Of Days Paid Leave:</strong> <span id="preview-paid-days">[Paid Days]</span><br>
                        <strong>No. Of Days Unpaid Leave:</strong> <span id="preview-unpaid-days">[Unpaid Days]</span><br>
                        <strong>Posted:</strong> <span id="preview-posted">[Posted Info]</span><br>
                        <strong>Date:</strong> <span id="preview-form-date">[Form Date]</span>
                    </td>
                    <td style="font-family: 'Mirza', cursive; direction: rtl; text-align: right; padding: 15px;">
                        <strong>ملاحظات شؤون العاملين</strong><br><br>
                        <strong>المتوقع العودة بتاريخ:</strong> <span id="preview-expected-return-ar">[Expected Date]</span><br>
                        <strong>الفعلي العودة بتاريخ:</strong> <span id="preview-actual-return-ar">[Actual Date]</span><br>
                        <strong>عدد الأيام المدفوعة:</strong> <span id="preview-paid-days-ar">[Paid Days]</span><br>
                        <strong>عدد الأيام غير المدفوعة:</strong> <span id="preview-unpaid-days-ar">[Unpaid Days]</span><br>
                        <strong>تم النشر:</strong> <span id="preview-posted-ar">[Posted Info]</span><br>
                        <strong>التاريخ:</strong> <span id="preview-form-date-ar">[Form Date]</span>
                    </td>
                </tr>
            </table>
            
            <div style="margin-top: 20px; text-align: center; font-family: 'Calibri', sans-serif; font-size: 12px; color: #666;">
                This form was generated by Al-Eid International Logistics Company
            </div>
        </div>
        
        <div class="buttons no-print">
            <button class="generate-btn" onclick="generatePDF()">Generate & Download PDF</button>
            <button class="reset-btn" onclick="resetForm()">Reset Form</button>
        </div>
        
        <div class="footer no-print">
            <p>Al-Eid International Logistics Company - شركة العيد انترناشيونال لوجستكس</p>
            <p>© 2026 All Rights Reserved</p>
        </div>
    </div>

    <script>
        // Set today's date as default for some fields
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('returnDate').value = today;
            document.getElementById('returnDateAr').value = today;
            
            // Sync all fields between English and Arabic
            const syncFields = [
                {en: 'employeeName', ar: 'employeeNameAr'},
                {en: 'employeeId', ar: 'employeeIdAr'},
                {en: 'department', ar: 'departmentAr'},
                {en: 'leaveStartDate', ar: 'leaveStartDateAr'},
                {en: 'leaveEndDate', ar: 'leaveEndDateAr'},
                {en: 'returnDate', ar: 'returnDateAr'},
                {en: 'expectedReturnDate', ar: 'expectedReturnDateAr'},
                {en: 'paidLeaveDays', ar: 'paidLeaveDaysAr'},
                {en: 'unpaidLeaveDays', ar: 'unpaidLeaveDaysAr'}
            ];
            
            // Set up synchronization
            syncFields.forEach(field => {
                const enElement = document.getElementById(field.en);
                const arElement = document.getElementById(field.ar);
                
                if (enElement && arElement) {
                    // Sync English to Arabic
                    enElement.addEventListener('input', function() {
                        arElement.value = this.value;
                        updatePreview();
                    });
                    
                    // Sync Arabic to English (for manual edits)
                    arElement.addEventListener('input', function() {
                        enElement.value = this.value;
                        updatePreview();
                    });
                    
                    // Initial sync
                    if (enElement.value) {
                        arElement.value = enElement.value;
                    }
                }
            });
            
            // Initial preview update
            updatePreview();
        });
        
        // Format date from YYYY-MM-DD to DD/MM/YYYY
        function formatDate(dateString) {
            if (!dateString) return "[Not Set]";
            const date = new Date(dateString);
            return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
        }
        
        function updatePreview() {

        // Update the preview section with form data
            const previewSection = document.getElementById('pdf-preview');
            previewSection.style.display = 'block';

            // Get the logo from the main header
            const mainLogo = document.querySelector('.logo-placeholder img');
            const pdfLogo = document.getElementById('pdf-logo-img');
            
            // Ensure the PDF logo element exists
            if (!pdfLogo) {
                console.error('PDF logo element not found');
            } else if (mainLogo && mainLogo.src) {
                // Copy the logo source to PDF preview
                pdfLogo.src = mainLogo.src;
                pdfLogo.style.display = 'block';
                pdfLogo.style.visibility = 'visible';
                pdfLogo.style.opacity = '1';
                
                // Ensure logo loads
                pdfLogo.onload = function() {
                    console.log('PDF logo loaded successfully');
                };
                
                pdfLogo.onerror = function() {
                    console.log('PDF logo failed to load, hiding placeholder');
                    this.style.display = 'none';
                    // Hide the parent placeholder if image fails
                    const placeholder = this.parentElement;
                    if (placeholder) {
                        placeholder.style.backgroundColor = '#f0f5ff';
                        placeholder.innerHTML = '<span style="color:#666;font-size:12px;">Logo</span>';
                    }
                };
            }
            
            // Get current form values
            const startDate = document.getElementById('leaveStartDate').value;
            const endDate = document.getElementById('leaveEndDate').value;
            const returnDate = document.getElementById('returnDate').value;
            const expectedReturnDate = document.getElementById('expectedReturnDate').value;
            const paidDays = document.getElementById('paidLeaveDays').value;
            const unpaidDays = document.getElementById('unpaidLeaveDays').value;
            const employeeName = document.getElementById('employeeName').value || "[Employee Name]";
            const employeeId = document.getElementById('employeeId').value || "[Employee ID]";
            const department = document.getElementById('department').value || "[Department]";
            
            // Format current date for the form
            const currentDate = new Date();
            const formattedCurrentDate = `${currentDate.getDate().toString().padStart(2, '0')}/${(currentDate.getMonth() + 1).toString().padStart(2, '0')}/${currentDate.getFullYear()}`;
            
            // Update preview fields
            document.getElementById('preview-date').textContent = formattedCurrentDate;
            document.getElementById('preview-date-ar').textContent = formattedCurrentDate;
            
            document.getElementById('preview-start-date').textContent = formatDate(startDate);
            document.getElementById('preview-start-date-ar').textContent = formatDate(startDate);
            
            document.getElementById('preview-end-date').textContent = formatDate(endDate);
            document.getElementById('preview-end-date-ar').textContent = formatDate(endDate);
            
            document.getElementById('preview-return-date').textContent = formatDate(returnDate);
            document.getElementById('preview-return-date-ar').textContent = formatDate(returnDate);
            
            document.getElementById('preview-expected-return').textContent = formatDate(expectedReturnDate);
            document.getElementById('preview-expected-return-ar').textContent = formatDate(expectedReturnDate);
            
            document.getElementById('preview-actual-return').textContent = formatDate(returnDate);
            document.getElementById('preview-actual-return-ar').textContent = formatDate(returnDate);
            
            document.getElementById('preview-paid-days').textContent = paidDays || "0";
            document.getElementById('preview-paid-days-ar').textContent = paidDays || "0";
            
            document.getElementById('preview-unpaid-days').textContent = unpaidDays || "0";
            document.getElementById('preview-unpaid-days-ar').textContent = unpaidDays || "0";
            
            // With these lines:
            document.getElementById('preview-posted').textContent = `${employeeName} (ID: ${employeeId}) - ${department}`;
            document.getElementById('preview-posted-ar').textContent = `${employeeName} (رقم: ${employeeId}) - ${department}`;
            
            document.getElementById('preview-form-date').textContent = formattedCurrentDate;
            document.getElementById('preview-form-date-ar').textContent = formattedCurrentDate;
        }
        
        // Generate and download PDF
        function generatePDF() {
    // First update the preview to ensure all data is current
    updatePreview();
    
    // Add a small delay to ensure images are loaded
    setTimeout(() => {
        // Get the preview element
        const element = document.getElementById('pdf-preview');
        
        // Show the preview
        element.style.display = 'block';
        element.style.visibility = 'visible';
        element.style.opacity = '1';
        
        // Use html2canvas with better settings
        html2canvas(element, {
            scale: 10, // Reduced to 2 for better compatibility
            useCORS: true,
            logging: true, // Enable logging to debug
            backgroundColor: '#ffffff',
            allowTaint: false, // Changed to false
            foreignObjectRendering: false, // Changed to false
            imageTimeout: 10000, // 10 seconds timeout
            removeContainer: true,
            onclone: function(clonedDoc) {
                // Ensure fonts are properly loaded
                const elements = clonedDoc.querySelectorAll('*');
                elements.forEach(el => {
                    el.style.fontFamily = window.getComputedStyle(el).fontFamily;
                });
                
                // Check if logo exists in cloned document
                const clonedLogo = clonedDoc.querySelector('#pdf-logo-img');
                if (clonedLogo) {
                    console.log('Logo found in cloned document:', clonedLogo.src);
                    clonedLogo.style.display = 'block';
                    clonedLogo.style.visibility = 'visible';
                } else {
                    console.log('Logo not found in cloned document');
                }
            }
        }).then(canvas => {
            console.log('Canvas created successfully. Dimensions:', canvas.width, 'x', canvas.height);
            
            // Check if canvas has content
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
            let empty = true;
            
            for (let i = 0; i < imageData.length; i += 4) {
                if (imageData[i + 3] !== 0) { // Check alpha channel
                    empty = false;
                    break;
                }
            }
            
            if (empty) {
                alert('Canvas is empty. Please check if the preview section is visible and has content.');
                return;
            }
            
            const imgData = canvas.toDataURL('image/png');
            
            // Create PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // Calculate dimensions to fit the content on A4
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const pdfHeight = pdf.internal.pageSize.getHeight();
            const imgWidth = pdfWidth - 20; // 10mm margins on each side
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            
            // Add the image to PDF
            pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
            
            // Check if content exceeds page height
            let heightLeft = imgHeight;
            let position = 0;
            
            if (heightLeft > pdfHeight) {
                while (heightLeft > 0) {
                    position = heightLeft - pdfHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 10, -position, imgWidth, imgHeight);
                    heightLeft -= pdfHeight;
                }
            }
            
            // Download the PDF
            const employeeName = document.getElementById('employeeName').value || 'employee';
            const returnDate = document.getElementById('returnDate').value || new Date().toISOString().split('T')[0];
            pdf.save(`Leave_Return_${employeeName}_${returnDate}.pdf`);
            
        }).catch(error => {
            console.error('Error generating PDF:', error);
            alert('Error generating PDF: ' + error.message);
        });
    }, 1000); // 1 second delay to ensure images load
}
        // Reset the form
        function resetForm() {
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'date') {
                    // Reset date fields except return date which defaults to today
                    if (input.id === 'returnDate' || input.id === 'returnDateAr') {
                        const today = new Date().toISOString().split('T')[0];
                        input.value = today;
                    } else {
                        input.value = '';
                    }
                } else if (input.type === 'number') {
                    input.value = '0';
                } else {
                    input.value = '';
                }
            });
            
            // Hide the preview
            document.getElementById('pdf-preview').style.display = 'none';
        }
    </script>
</body>
</html>